
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../distances.RISPIKE/">
      
      
        <link rel="next" href="../distances.spikeship/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>5. Spike Pattern Optimal Transport (SPOT) distance - SpykeTools</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#spyketools.distances.SPOTDis" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="SpykeTools" class="md-header__button md-logo" aria-label="SpykeTools" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SpykeTools
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              5. Spike Pattern Optimal Transport (SPOT) distance
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/spyketools-org/spyketools" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="SpykeTools" class="md-nav__button md-logo" aria-label="SpykeTools" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    SpykeTools
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/spyketools-org/spyketools" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          Computation of distances between two spike trains
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Computation of distances between two spike trains
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/single_neuron_distances/" class="md-nav__link">
        Single Neuron distances
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          Integration with Neurodata Without Borders (NWB)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Integration with Neurodata Without Borders (NWB)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/NWB_data_analysis_tutorial/" class="md-nav__link">
        Data Analysis of Allen Brain Institute dataset
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          Computation of distances for Neural Ensembles
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Computation of distances for Neural Ensembles
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/NeuralEnsembles_pairwise_distances/" class="md-nav__link">
        Parallel computing of pairwise distances
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
      
      
      
        <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
          Decoding performance
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          Decoding performance
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/clustering_performance/" class="md-nav__link">
        Clustering performance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
      
      
      
        <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
          Visualization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          Visualization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/visualization_tutorial/" class="md-nav__link">
        Raster plots
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
      
      
      
        <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
          IO
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          IO
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../io.DataManager/" class="md-nav__link">
        Handling neuronal data in NWB format
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          Distances
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Distances
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../distances.victor_purpura/" class="md-nav__link">
        1. Victor-Purpura (VP) distance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../distances.ISI/" class="md-nav__link">
        2. Inter-Spike Interval (ISI) distance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../distances.SPIKE/" class="md-nav__link">
        3. SPIKE distance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../distances.RISPIKE/" class="md-nav__link">
        4. Rate-Independent SPIKE (RI-SPIKE) distance
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          5. Spike Pattern Optimal Transport (SPOT) distance
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        5. Spike Pattern Optimal Transport (SPOT) distance
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spyketools.distances.SPOTDis" class="md-nav__link">
    spyketools.distances.SPOTDis
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyketools.distances.SPOTDis.signature_emd_" class="md-nav__link">
    signature_emd_()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyketools.distances.SPOTDis.xcorr_spotdis_cpu_" class="md-nav__link">
    xcorr_spotdis_cpu_()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyketools.distances.SPOTDis.spike_spotdis_cpu_" class="md-nav__link">
    spike_spotdis_cpu_()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyketools.distances.SPOTDis.distances" class="md-nav__link">
    distances()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyketools.distances.SPOTDis.xcorr_list" class="md-nav__link">
    xcorr_list()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../distances.spikeship/" class="md-nav__link">
        6. SpikeShip distance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          Manifold learning algorithms
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Manifold learning algorithms
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manifold.tsne/" class="md-nav__link">
        1. 2D T-distributed Stochastic Neighbor Embedding (t-SNE)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manifold.umap/" class="md-nav__link">
        2. 2D Uniform Manifold Approximation and Projection for Dimension Reduction (UMAP)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
      
      
      
        <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
          Clustering performance
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Clustering performance
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../clustering.ARI_score/" class="md-nav__link">
        1. Adjusted Rand Index (ARI)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../clustering.silhouette_score/" class="md-nav__link">
        2. Silhouette score
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../clustering.discriminability_index/" class="md-nav__link">
        3. Discriminability Index (DI)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
      
      
      
        <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
          Visualization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Visualization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../vis.raster/" class="md-nav__link">
        1. Raster plots
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../datasets.load_allen_brain_ds/" class="md-nav__link">
        Pre-processed datasets
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../citing/" class="md-nav__link">
        Citing
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spyketools.distances.SPOTDis" class="md-nav__link">
    spyketools.distances.SPOTDis
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyketools.distances.SPOTDis.signature_emd_" class="md-nav__link">
    signature_emd_()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyketools.distances.SPOTDis.xcorr_spotdis_cpu_" class="md-nav__link">
    xcorr_spotdis_cpu_()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyketools.distances.SPOTDis.spike_spotdis_cpu_" class="md-nav__link">
    spike_spotdis_cpu_()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyketools.distances.SPOTDis.distances" class="md-nav__link">
    distances()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spyketools.distances.SPOTDis.xcorr_list" class="md-nav__link">
    xcorr_list()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>5. Spike Pattern Optimal Transport (SPOT) distance</h1>

<div class="doc doc-object doc-module">


<a id="spyketools.distances.SPOTDis"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="spyketools.distances.SPOTDis.signature_emd_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">signature_emd_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>A fast implementation of the EMD on sparse 1D signatures like described in:
Grossberger, L., Battaglia, FP. and Vinck, M. (2018). Unsupervised clustering
of temporal patterns in high-dimensional neuronal ensembles using a novel
dissimilarity measure. Source: https://github.com/LGro/spot/tree/main.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>numpy.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of occurrences / a histogram signature
Note: Needs to be non-empty and longer or equally long as y</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>numpy.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of occurrences / a histogram signature
Notes: Needs to be non-empty and shorter or equally long as x</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>distance</code></td>          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Earth Mover's Distances between the two signatures / occurrence lists</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>spyketools/distances/SPOTDis.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">signature_emd_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A fast implementation of the EMD on sparse 1D signatures like described in:</span>
<span class="sd">    Grossberger, L., Battaglia, FP. and Vinck, M. (2018). Unsupervised clustering</span>
<span class="sd">    of temporal patterns in high-dimensional neuronal ensembles using a novel</span>
<span class="sd">    dissimilarity measure. Source: https://github.com/LGro/spot/tree/main.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : numpy.ndarray</span>
<span class="sd">        List of occurrences / a histogram signature</span>
<span class="sd">        Note: Needs to be non-empty and longer or equally long as y</span>
<span class="sd">    y : numpy.ndarray</span>
<span class="sd">        List of occurrences / a histogram signature</span>
<span class="sd">        Notes: Needs to be non-empty and shorter or equally long as x</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    distance : float</span>
<span class="sd">        Earth Mover&#39;s Distances between the two signatures / occurrence lists</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Q</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">Q</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">R</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">if</span> <span class="n">Q</span> <span class="o">&lt;</span> <span class="n">R</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;First argument must be longer than or equally long as second.&#39;</span><span class="p">)</span>

    <span class="n">x</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">y</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="c1"># Use integers as weights since they are less prome to precision issues when subtracting</span>
    <span class="n">w_x</span> <span class="o">=</span> <span class="n">R</span> <span class="c1"># = Q*R/Q</span>
    <span class="n">w_y</span> <span class="o">=</span> <span class="n">Q</span> <span class="c1"># = Q*R/R</span>

    <span class="n">emd</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">q</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">q</span> <span class="o">&lt;</span> <span class="n">Q</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">w_x</span> <span class="o">&lt;=</span> <span class="n">w_y</span><span class="p">:</span>
            <span class="n">cost</span> <span class="o">=</span> <span class="n">w_x</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="n">w_y</span> <span class="o">-=</span> <span class="n">w_x</span>
            <span class="n">w_x</span> <span class="o">=</span> <span class="n">R</span>
            <span class="n">q</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cost</span> <span class="o">=</span> <span class="n">w_y</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="n">w_x</span> <span class="o">-=</span> <span class="n">w_y</span>
            <span class="n">w_y</span> <span class="o">=</span> <span class="n">Q</span>
            <span class="n">r</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">emd</span> <span class="o">+=</span> <span class="n">cost</span>

    <span class="c1"># Correct for the initial scaling to integer weights</span>
    <span class="k">return</span> <span class="n">emd</span><span class="o">/</span><span class="p">(</span><span class="n">Q</span><span class="o">*</span><span class="n">R</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="spyketools.distances.SPOTDis.xcorr_spotdis_cpu_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">xcorr_spotdis_cpu_</span><span class="p">(</span><span class="n">spike_times</span><span class="p">,</span> <span class="n">ii_spike_times</span><span class="p">,</span> <span class="n">epoch_index_pairs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Compute distances between channel cross correlation pairs using all available CPU cores.
The specific type of distance is provided via the parameter 'metric'.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>spike_times</code></td>
          <td>
                <code>numpy.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>1 dimensional matrix containing all spike times</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>ii_spike_times : numpy.ndarray
    MxNx2 dimensional matrix containing the start and end index for the spike_times array
    for any given epoch and channel combination</p>
<p>epoch_index_pairs : numpy.ndarray
    (M*(M-1)/2)x2 dimensional matrix containing all unique epoch index pairs</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>distances</code></td>          <td>
                <code>numpy.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>MxM distance matrix with numpy.nan for unknown distances and on the diagonal</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>spyketools/distances/SPOTDis.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">xcorr_spotdis_cpu_</span><span class="p">(</span><span class="n">spike_times</span><span class="p">,</span> <span class="n">ii_spike_times</span><span class="p">,</span> <span class="n">epoch_index_pairs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute distances between channel cross correlation pairs using all available CPU cores.</span>
<span class="sd">    The specific type of distance is provided via the parameter &#39;metric&#39;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spike_times : numpy.ndarray</span>
<span class="sd">        1 dimensional matrix containing all spike times</span>

<span class="sd">    ii_spike_times : numpy.ndarray</span>
<span class="sd">        MxNx2 dimensional matrix containing the start and end index for the spike_times array</span>
<span class="sd">        for any given epoch and channel combination</span>

<span class="sd">    epoch_index_pairs : numpy.ndarray</span>
<span class="sd">        (M*(M-1)/2)x2 dimensional matrix containing all unique epoch index pairs</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    distances : numpy.ndarray</span>
<span class="sd">        MxM distance matrix with numpy.nan for unknown distances and on the diagonal</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get data dimensions</span>
    <span class="n">n_epochs</span> <span class="o">=</span> <span class="n">ii_spike_times</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_channels</span> <span class="o">=</span> <span class="n">ii_spike_times</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">n_epoch_index_pairs</span> <span class="o">=</span> <span class="n">epoch_index_pairs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Initialize distance matrix</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n_epochs</span><span class="p">,</span> <span class="n">n_epochs</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="n">nan_count</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1"># For each epoch pair</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">n_epoch_index_pairs</span><span class="p">):</span>
        <span class="n">e1</span> <span class="o">=</span> <span class="n">epoch_index_pairs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="n">epoch_index_pairs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Compute distances for all xcorr pairs between the two epochs</span>
        <span class="n">xcorr_distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_channels</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_channels</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">n_xcorr_distances</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">i_xcorr_distance</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">c1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_channels</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">c2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c1</span><span class="p">):</span>
                <span class="n">i_xcorr_distance</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1"># Only compute the xcorrs and distance in case there is a spike in all relevant channels</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e1</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e1</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e2</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e2</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e2</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e2</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>

                    <span class="c1"># Compute the xcorrs</span>
                    <span class="n">xcorr1</span> <span class="o">=</span> <span class="n">xcorr_list</span><span class="p">(</span>
                            <span class="n">spike_times</span><span class="p">[</span><span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e1</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="mi">0</span><span class="p">]:</span><span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e1</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span>
                            <span class="n">spike_times</span><span class="p">[</span><span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="mi">0</span><span class="p">]:</span><span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
                    <span class="n">xcorr2</span> <span class="o">=</span> <span class="n">xcorr_list</span><span class="p">(</span>
                            <span class="n">spike_times</span><span class="p">[</span><span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e2</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="mi">0</span><span class="p">]:</span><span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e2</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span>
                            <span class="n">spike_times</span><span class="p">[</span><span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e2</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="mi">0</span><span class="p">]:</span><span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e2</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>

                    <span class="c1"># EMD</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xcorr1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xcorr2</span><span class="p">):</span>
                        <span class="n">xcorr_distances</span><span class="p">[</span><span class="n">i_xcorr_distance</span><span class="p">]</span> <span class="o">=</span> <span class="n">signature_emd_</span><span class="p">(</span><span class="n">xcorr1</span><span class="p">,</span> <span class="n">xcorr2</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">xcorr_distances</span><span class="p">[</span><span class="n">i_xcorr_distance</span><span class="p">]</span> <span class="o">=</span> <span class="n">signature_emd_</span><span class="p">(</span><span class="n">xcorr2</span><span class="p">,</span> <span class="n">xcorr1</span><span class="p">)</span>

                    <span class="n">n_xcorr_distances</span> <span class="o">=</span> <span class="n">n_xcorr_distances</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nan_count</span> <span class="o">=</span> <span class="n">nan_count</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># Save average xcorr distance</span>
        <span class="k">if</span> <span class="n">n_xcorr_distances</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">distances</span><span class="p">[</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">xcorr_distances</span><span class="p">)</span>
            <span class="n">distances</span><span class="p">[</span><span class="n">e2</span><span class="p">,</span> <span class="n">e1</span><span class="p">]</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">]</span>

    <span class="n">percent_nan</span> <span class="o">=</span> <span class="n">nan_count</span> <span class="o">/</span> <span class="p">((</span><span class="n">n_channels</span><span class="o">*</span><span class="p">(</span><span class="n">n_channels</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">n_epoch_index_pairs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">distances</span><span class="p">,</span> <span class="n">percent_nan</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="spyketools.distances.SPOTDis.spike_spotdis_cpu_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">spike_spotdis_cpu_</span><span class="p">(</span><span class="n">spike_times</span><span class="p">,</span> <span class="n">ii_spike_times</span><span class="p">,</span> <span class="n">epoch_index_pairs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Compute the given metric directly on spike times of all M epochs with N channels
using all available CPU cores.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>spike_times</code></td>
          <td>
                <code>numpy.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>1 dimensional matrix containing all spike times</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>ii_spike_times : numpy.ndarray
    MxNx2 dimensional matrix containing the start and end index for the spike_times array
    for any given epoch and channel combination</p>
<p>epoch_index_pairs : numpy.ndarray
    (M*(M-1)/2)x2 dimensional matrix containing all unique epoch index pairs</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>distances</code></td>          <td>
                <code>numpy.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>MxM distance matrix with numpy.nan for unknown distances and on the diagonal</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>spyketools/distances/SPOTDis.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">spike_spotdis_cpu_</span><span class="p">(</span><span class="n">spike_times</span><span class="p">,</span> <span class="n">ii_spike_times</span><span class="p">,</span> <span class="n">epoch_index_pairs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the given metric directly on spike times of all M epochs with N channels</span>
<span class="sd">    using all available CPU cores.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spike_times : numpy.ndarray</span>
<span class="sd">        1 dimensional matrix containing all spike times</span>

<span class="sd">    ii_spike_times : numpy.ndarray</span>
<span class="sd">        MxNx2 dimensional matrix containing the start and end index for the spike_times array</span>
<span class="sd">        for any given epoch and channel combination</span>

<span class="sd">    epoch_index_pairs : numpy.ndarray</span>
<span class="sd">        (M*(M-1)/2)x2 dimensional matrix containing all unique epoch index pairs</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    distances : numpy.ndarray</span>
<span class="sd">        MxM distance matrix with numpy.nan for unknown distances and on the diagonal</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get data dimensions</span>
    <span class="n">n_epochs</span> <span class="o">=</span> <span class="n">ii_spike_times</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_channels</span> <span class="o">=</span> <span class="n">ii_spike_times</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">n_epoch_index_pairs</span> <span class="o">=</span> <span class="n">epoch_index_pairs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Initialize distance matrix</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n_epochs</span><span class="p">,</span> <span class="n">n_epochs</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="n">nan_count</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1"># For each epoch pair</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">n_epoch_index_pairs</span><span class="p">):</span>
        <span class="n">e1</span> <span class="o">=</span> <span class="n">epoch_index_pairs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="n">epoch_index_pairs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Compute distances for all neuron pairs between the two epochs</span>
        <span class="n">neuron_distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_channels</span><span class="p">):</span>
            <span class="c1"># Only compute the emd if there is a spike in that channels in both epochs</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e1</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e1</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="ow">and</span> <span class="p">(</span><span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e2</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e2</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>

                <span class="n">channel_spikes_e1</span> <span class="o">=</span> <span class="n">spike_times</span><span class="p">[</span><span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e1</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">0</span><span class="p">]:</span><span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e1</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">channel_spikes_e2</span> <span class="o">=</span> <span class="n">spike_times</span><span class="p">[</span><span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e2</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">0</span><span class="p">]:</span><span class="n">ii_spike_times</span><span class="p">[</span><span class="n">e2</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>

                <span class="c1"># EMD</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">channel_spikes_e1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">channel_spikes_e2</span><span class="p">):</span>
                    <span class="n">neuron_distances</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">signature_emd_</span><span class="p">(</span><span class="n">channel_spikes_e1</span><span class="p">,</span> <span class="n">channel_spikes_e2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">neuron_distances</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">signature_emd_</span><span class="p">(</span><span class="n">channel_spikes_e2</span><span class="p">,</span> <span class="n">channel_spikes_e1</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">nan_count</span> <span class="o">=</span> <span class="n">nan_count</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># Save average and std of distances</span>
        <span class="n">distances</span><span class="p">[</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">neuron_distances</span><span class="p">)</span>
        <span class="n">distances</span><span class="p">[</span><span class="n">e2</span><span class="p">,</span> <span class="n">e1</span><span class="p">]</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">]</span>

    <span class="n">percent_nan</span> <span class="o">=</span> <span class="n">nan_count</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_channels</span><span class="o">*</span><span class="n">n_epoch_index_pairs</span><span class="p">)</span>

    <span class="c1"># Set diagonal to zero</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">):</span>
        <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#distance_stds[i, i] = 0</span>

    <span class="c1">#return distances, distance_stds, percent_nan</span>
    <span class="k">return</span> <span class="n">distances</span><span class="p">,</span> <span class="n">percent_nan</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="spyketools.distances.SPOTDis.distances" class="doc doc-heading">
<code class="highlight language-python"><span class="n">distances</span><span class="p">(</span><span class="n">spike_times</span><span class="p">,</span> <span class="n">ii_spike_times</span><span class="p">,</span> <span class="n">epoch_length</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;SPOTD_xcorr&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Compute temporal distances based on various versions of the SPOTDis, using CPU parallelization.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>spike_times</code></td>
          <td>
                <code>numpy.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>1 dimensional matrix containing all spike times</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>ii_spike_times : numpy.ndarray
    MxNx2 dimensional matrix containing the start and end index for the spike_times array
    for any given epoch and channel combination</p>
<p>metric : str
    Pick the specific metric by combining the metric ID with either 'xcorr' to compute it on
    pairwise xcorr histograms or 'times' to compute it directly on spike times.
    Currently available:
        * SPOTD_xcorr
        * SPOTD_xcorr_pooled
        * SPOTD_spikes</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>distances</code></td>          <td>
                <code>numpy.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>MxM distance matrix with numpy.nan for unknown distances</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>spyketools/distances/SPOTDis.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">distances</span><span class="p">(</span><span class="n">spike_times</span><span class="p">,</span> <span class="n">ii_spike_times</span><span class="p">,</span> <span class="n">epoch_length</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;SPOTD_xcorr&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute temporal distances based on various versions of the SPOTDis, using CPU parallelization.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spike_times : numpy.ndarray</span>
<span class="sd">        1 dimensional matrix containing all spike times</span>

<span class="sd">    ii_spike_times : numpy.ndarray</span>
<span class="sd">        MxNx2 dimensional matrix containing the start and end index for the spike_times array</span>
<span class="sd">        for any given epoch and channel combination</span>

<span class="sd">    metric : str</span>
<span class="sd">        Pick the specific metric by combining the metric ID with either &#39;xcorr&#39; to compute it on</span>
<span class="sd">        pairwise xcorr histograms or &#39;times&#39; to compute it directly on spike times.</span>
<span class="sd">        Currently available:</span>
<span class="sd">            * SPOTD_xcorr</span>
<span class="sd">            * SPOTD_xcorr_pooled</span>
<span class="sd">            * SPOTD_spikes</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    distances : numpy.ndarray</span>
<span class="sd">        MxM distance matrix with numpy.nan for unknown distances</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n_epochs</span> <span class="o">=</span> <span class="n">ii_spike_times</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">epoch_index_pairs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">),</span> <span class="mi">2</span><span class="p">)),</span>
        <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># SPOTDis comparing the pairwise xcorrs of channels</span>
    <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;SPOTD_xcorr&#39;</span><span class="p">:</span>
        <span class="n">distances</span><span class="p">,</span> <span class="n">percent_nan</span> <span class="o">=</span> <span class="n">xcorr_spotdis_cpu_</span><span class="p">(</span>
            <span class="n">spike_times</span><span class="p">,</span> <span class="n">ii_spike_times</span><span class="p">,</span> <span class="n">epoch_index_pairs</span><span class="p">)</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="n">distances</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">epoch_length</span><span class="p">)</span>

    <span class="c1"># SPOTDis comparing the xcorr of a channel with all other channels pooled</span>
    <span class="k">elif</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;SPOTD_xcorr_pooled&#39;</span><span class="p">:</span>
        <span class="n">distances</span><span class="p">,</span> <span class="n">percent_nan</span> <span class="o">=</span> <span class="n">xcorr_pooled_spotdis_cpu_</span><span class="p">(</span>
            <span class="n">spike_times</span><span class="p">,</span> <span class="n">ii_spike_times</span><span class="p">,</span> <span class="n">epoch_index_pairs</span><span class="p">)</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="n">distances</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">epoch_length</span><span class="p">)</span>

    <span class="c1"># SPOTDis comparing raw spike trains</span>
    <span class="k">elif</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;SPOTD_spikes&#39;</span><span class="p">:</span>
        <span class="n">distances</span><span class="p">,</span> <span class="n">percent_nan</span> <span class="o">=</span> <span class="n">spike_spotdis_cpu_</span><span class="p">(</span>
            <span class="n">spike_times</span><span class="p">,</span> <span class="n">ii_spike_times</span><span class="p">,</span> <span class="n">epoch_index_pairs</span><span class="p">)</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="n">distances</span> <span class="o">/</span> <span class="n">epoch_length</span>

    <span class="c1"># Otherwise, raise exception</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Metric &quot;</span><span class="si">{}</span><span class="s1">&quot; unavailable, check doc-string for alternatives.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">metric</span><span class="p">))</span>

    <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">distances</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="spyketools.distances.SPOTDis.xcorr_list" class="doc doc-heading">
<code class="highlight language-python"><span class="n">xcorr_list</span><span class="p">(</span><span class="n">in1</span><span class="p">,</span> <span class="n">in2</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>List of all time delays from a full cross correlation of the two inputs</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>in1</code></td>
          <td>
                <code>numpy.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Occurence times / indices</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>in2</code></td>
          <td>
                <code>numpy.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Occurence times / indices</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>spyketools/distances/SPOTDis.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">xcorr_list</span><span class="p">(</span><span class="n">in1</span><span class="p">,</span> <span class="n">in2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List of all time delays from a full cross correlation of the two inputs</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in1 : numpy.ndarray</span>
<span class="sd">        Occurence times / indices</span>
<span class="sd">    in2 : numpy.ndarray</span>
<span class="sd">        Occurence times / indices</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">in1</span><span class="p">)</span>
    <span class="n">n2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">in2</span><span class="p">)</span>

    <span class="n">C</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">n1</span><span class="o">*</span><span class="n">n2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n2</span><span class="p">):</span>
            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">n2</span><span class="o">+</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">in2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">in1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">C</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 Boris Sotomayor-Gmez
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "content.code.copy", "content.tooltips", "search.highlight", "search.suggest", "toc.follow", "content.tabs.link"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.b4d07000.min.js"></script>
      
    
  </body>
</html>